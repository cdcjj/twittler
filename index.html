<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Twittler</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="timestamp.js"></script>
    <script src="jquery.timeago.js"></script>
  </head>
  <body>

    <!-- Header -->

    <header>
      <h1>Twittler</h1>
      <h3>Welcome, Visitor!</h3>
      <h4 class="dateToday"></h4>
    </header>

    <!-- New Tweet Alert -->
    <section> 
      <div id='newTweets'><strong>No new tweets</strong></div>
    </section>

    <!-- Tweet Feed -->
    <section class="feed"></section>

    <script>
    window.visitor;

      $(document).ready(function(){
        // jQuery("time.timeago").timeago();

        // DOM shortcuts
        var $tweetfeed = $('.feed');
        // var $newTweets = $('#newTweets');

        var notPostedTw = 0;
        var totalPosted = streams.home.length;
        var newTweetTotal = 0;

        var today = function() {
          var todayDate = formatDate(new Date());
          $('.dateToday').text(todayDate);

          setTimeout(function() {
            today();
          }, 7.2e+6);
        }
        today();        

        // Displays 11 tweets at page load
        var displayATweet = function(index) {
          var tweet = streams.home[index];
          // var timestamp =
          var $tweet = $('<a><img class="avatar" src="images/' + tweet.user + 
            '.jpg"></a><div class="tweets"><p class="user">@' + tweet.user + 
            ':<br></p><p class="message">' + tweet.message + 
            '</p><br><p class="timestamp">' + tweet.created_at + 
            '</p></div>');

          $tweet.prependTo($tweetfeed);
          $tweet.animate({'opacity' : '1'}, 1000);

        };

        var index = streams.home.length - 1;
        while (index >= 0) {
          var newTweet = displayATweet(index);
          index -= 1;
        }
        

        // Initialize checkNewTweets();
        var checkNewTweets = function() {
          // Check current tweet count;
          newTweetTotal = streams.home.length;
          notPostedTw = newTweetTotal - totalPosted;

          // display or hide newTweet message
          if (notPostedTw > 0) {
            $('#newTweets').fadeIn();
            $('#newTweets').text("Click to see " + notPostedTw + " new tweets.");
          // }
          } else{
            $('#newTweets').hide();
          }

          // recursion--- check for new tweets every 2 minutes (120000ms)
          setTimeout(function() {
            checkNewTweets();
          }, 6000);
        }
        checkNewTweets();

        var showNewTweets = function() {
          for (var i = totalPosted; i < newTweetTotal; i++){
            displayATweet(i);
          }

          // update variables and hide newTweet button
          totalPosted = newTweetTotal;
          $('#newTweets').hide();
        }

        $('#newTweets').on('click', function() {
          showNewTweets();
        })


      });

    </script>
  </body>
  <footer class="primary-footer">
    <small>&copy; Twittler: recreation of Twitter for Hack Reactor Pre-Course</small>
  </footer>
</html>
